#!/bin/bash

# è‡ªåŠ¨ç”ŸæˆWeb3AuthçŽ¯å¢ƒå˜é‡è„šæœ¬
# ç”ŸæˆSALTã€KEYã€IVä¸‰ä¸ªåŠ å¯†ç›¸å…³çš„çŽ¯å¢ƒå˜é‡

echo "ðŸ” æ­£åœ¨ç”ŸæˆWeb3AuthçŽ¯å¢ƒå˜é‡..."

# ç”Ÿæˆ32å­—èŠ‚çš„éšæœºSALT (64ä¸ªåå…­è¿›åˆ¶å­—ç¬¦)
SALT=$(openssl rand -hex 32)

# ç”Ÿæˆ32å­—èŠ‚çš„éšæœºKEY (64ä¸ªåå…­è¿›åˆ¶å­—ç¬¦)
KEY=$(openssl rand -hex 32)

# ç”Ÿæˆ16å­—èŠ‚çš„éšæœºIV (32ä¸ªåå…­è¿›åˆ¶å­—ç¬¦)
IV=$(openssl rand -hex 16)

# é»˜è®¤é…ç½®è®¾ç½®
CLUSTER="https://api.devnet.solana.com"
PORT=4000
MIN_BALANCE=0

echo ""
echo "âœ… çŽ¯å¢ƒå˜é‡ç”Ÿæˆå®Œæˆï¼"
echo ""
echo "è¯·å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ‚¨çš„ .env æ–‡ä»¶ä¸­ï¼š"
echo "================================================"
echo "SALT=$SALT"
echo "KEY=$KEY"
echo "IV=$IV"
echo "CLUSTER=$CLUSTER"
echo "PORT=$PORT"
echo "MIN_BALANCE=$MIN_BALANCE"
echo "================================================"
echo ""

# è¯¢é—®æ˜¯å¦ç›´æŽ¥å†™å…¥.envæ–‡ä»¶
read -p "æ˜¯å¦ç›´æŽ¥å†™å…¥åˆ° .env æ–‡ä»¶ï¼Ÿ(y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    # å¤‡ä»½çŽ°æœ‰çš„.envæ–‡ä»¶ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
    if [ -f ".env" ]; then
        cp .env .env.backup.$(date +%Y%m%d_%H%M%S)
        echo "ðŸ“‹ å·²å¤‡ä»½çŽ°æœ‰ .env æ–‡ä»¶"
    fi
    
    # å†™å…¥æ–°çš„çŽ¯å¢ƒå˜é‡
    cat > .env << EOF
# Web3Auth çŽ¯å¢ƒå˜é‡é…ç½®
# è‡ªåŠ¨ç”ŸæˆäºŽ: $(date)

# åŠ å¯†ç›å€¼ (32å­—èŠ‚åå…­è¿›åˆ¶)
SALT=$SALT

# åŠ å¯†å¯†é’¥ (32å­—èŠ‚åå…­è¿›åˆ¶)
KEY=$KEY

# åˆå§‹åŒ–å‘é‡ (16å­—èŠ‚åå…­è¿›åˆ¶)
IV=$IV

# Solanaé›†ç¾¤é…ç½®
CLUSTER=$CLUSTER

# æœåŠ¡ç«¯å£
PORT=$PORT

# æœ€å°ä½™é¢è¦æ±‚
MIN_BALANCE=$MIN_BALANCE

# å¯é€‰ï¼šå…è®¸çš„æ¥æºåŸŸå (ç”¨é€—å·åˆ†éš”)
# ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com
EOF
    
    echo "âœ… çŽ¯å¢ƒå˜é‡å·²å†™å…¥ .env æ–‡ä»¶"
    echo "ðŸ”’ è¯·ç¡®ä¿ .env æ–‡ä»¶ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿ"
else
    echo "ðŸ“ è¯·æ‰‹åŠ¨å°†ä¸Šè¿°çŽ¯å¢ƒå˜é‡å¤åˆ¶åˆ°æ‚¨çš„ .env æ–‡ä»¶ä¸­"
fi

echo ""
echo "ðŸ›¡ï¸  å®‰å…¨æç¤ºï¼š"
echo "- è¿™äº›å¯†é’¥ç”¨äºŽåŠ å¯†ç”¨æˆ·æ•°æ®ï¼Œè¯·å¦¥å–„ä¿ç®¡"
echo "- ä¸è¦å°† .env æ–‡ä»¶æäº¤åˆ° Git ä»“åº“"
echo "- åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨æ›´å¼ºçš„éšæœºæº"
echo "- å®šæœŸè½®æ¢è¿™äº›å¯†é’¥ä»¥æé«˜å®‰å…¨æ€§"
echo ""
echo "ðŸš€ çŽ°åœ¨æ‚¨å¯ä»¥å¯åŠ¨Web3AuthæœåŠ¡äº†ï¼"